# Research & Design Decisions

This document records the key technology and architectural decisions for the Phase 2 "Interactive RAG Chatbot & Auth" feature.

## Core Technology Stack

- **Backend Framework**: FastAPI
  - **Rationale**: FastAPI is a modern, high-performance Python web framework that is easy to learn, fast to code, and provides automatic interactive API documentation (via OpenAPI). This is ideal for the RAG backend.
- **Frontend Framework**: React (within Docusaurus)
  - **Rationale**: Docusaurus is built with React, so creating the chatbot widget as a React component is the native and most effective approach for seamless integration.
- **Chat UI SDK**: ChatKit JS/TS SDK
  - **Rationale**: As specified in the requirements, ChatKit provides a pre-built set of UI components for building chat applications, which will accelerate frontend development.
- **AI SDK**: OpenAI Agents SDK (Python)
  - **Rationale**: The requirements specify the use of the OpenAI Agents SDK, which will be used to handle the RAG logic and interactions with the OpenAI API.
- **Database**: Neon Serverless Postgres
  - **Rationale**: Neon provides a serverless, scalable PostgreSQL database that is well-suited for storing user data and chat history, with a generous free tier.
- **Vector Database**: Qdrant Cloud (Free Tier)
  - **Rationale**: Qdrant is a high-performance vector database designed for similarity search, making it an excellent choice for storing and retrieving embeddings for the RAG system. The Free Tier is sufficient for this project's scale.
- **Authentication**: Better-Auth
  - **Rationale**: As specified in the optional bonus requirements, Better-Auth will be used for user signup and login, providing a secure, JWT-based authentication system.

## Architectural Decisions

- **Two-Mode Retrieval**:
  - **Decision**: The system will support two distinct retrieval modes: a normal RAG mode that queries the entire book's embeddings, and a selection-only mode that generates and queries embeddings on-the-fly for a highlighted text snippet.
  - **Rationale**: This provides flexibility for the user, allowing them to ask both general and highly specific questions.
- **Grounded Answers**:
  - **Decision**: Every answer generated by the chatbot MUST cite the source chapter and section from the textbook. The system will be designed to reject any out-of-scope queries.
  - **Rationale**: This adheres to the "Zero Hallucination Rule" (NFR-002) and ensures the chatbot is a reliable learning tool.
- **Personalization**:
  - **Decision**: For authenticated users, the chatbot will tailor its responses based on the user's self-reported experience level (software, hardware, robotics, AI/ML).
  - **Rationale**: This enhances the learning experience by providing more relevant and accessible answers for both beginners and advanced users.
- **Deployment Strategy**:
  - **Decision**: The FastAPI backend will be deployed to a cloud platform like Render or Vercel. The Docusaurus frontend, now including the integrated chatbot widget, will continue to be deployed to GitHub Pages.
  - **Rationale**: This separates the concerns of the static frontend and the dynamic backend, allowing for independent scaling and deployment.
